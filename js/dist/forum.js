(()=>{var e={n:n=>{var t=n&&n.__esModule?()=>n.default:()=>n;return e.d(t,{a:t}),t},d:(n,t)=>{for(var o in t)e.o(t,o)&&!e.o(n,o)&&Object.defineProperty(n,o,{enumerable:!0,get:t[o]})},o:(e,n)=>Object.prototype.hasOwnProperty.call(e,n)};(()=>{"use strict";const n=flarum.reg.get("core","forum/app");var t=e.n(n);const o=flarum.reg.get("core","common/extend"),r=flarum.reg.get("core","forum/components/DiscussionPage");var a=e.n(r);function s(){try{const e=window.location.pathname,n=e.split("/").filter(e=>e.length>0);if(n.length>=2&&"d"===n[0]){if(!(n.length>=3))return 1;{const e=n[2],t=parseInt(e,10);if(!isNaN(t)&&t>=1)return t}}console.warn("Current URL does not match expected discussion format for post number:",e)}catch(e){console.error("Error parsing post number from path:",e)}return 1}flarum.reg.add("laitouaigre-pages","forum/utils/urlUtils",{getCurrentPostNumberFromPath:s});let i=null,l=null,u=null,d=!1;function c(){return l}function p(){return d}function g(e,n){d&&l&&u&&(l.value=e,l.min=1,l.max=n,u.textContent=" of ".concat(n))}function m(){i&&i.parentNode&&i.parentNode.removeChild(i),i=null,l=null,u=null,d=!1}function f(e,n){if(d)return;i=document.createElement("div"),i.className="flarum-page-counter-container",Object.assign(i.style,{position:"fixed",bottom:"20px",right:"20px",zIndex:"9999",backgroundColor:"#1B2028",backdropFilter:"blur(12px)",borderRadius:"16px",padding:"6px 8px",display:"flex",alignItems:"center",gap:"6px",fontSize:"15px",fontWeight:"600",color:"white",transition:"all 0.3s ease",opacity:"0.95"});const t=()=>{i.style.opacity="1",i.style.transform="translateY(-2px)",i.style.boxShadow="0 6px 24px rgba(0, 0, 0, 0.4)"},o=()=>{i.style.opacity="0.95",i.style.transform="translateY(0)",i.style.boxShadow="0 4px 20px rgba(0, 0, 0, 0.3)"};i.addEventListener("mouseenter",t),i.addEventListener("mouseleave",o),i._pageCounterMouseEnterHandler=t,i._pageCounterMouseLeaveHandler=o,l=document.createElement("input"),l.className="flarum-page-counter-input",l.type="number",l.min="1",l.max="1",l.value="1",Object.assign(l.style,{width:"40px",padding:"6px 8px",margin:"0",backgroundColor:"#212831",border:"1px solid rgba(255, 255, 255, 0.2)",borderRadius:"12px",color:"white",fontSize:"15px",fontWeight:"600",textAlign:"center",outline:"none",flexShrink:0});const r="flarum-page-counter-hide-arrows";if(!document.getElementById(r)){const e=document.createElement("style");e.id=r,e.textContent="\n          .flarum-page-counter-input::-webkit-outer-spin-button,\n          .flarum-page-counter-input::-webkit-inner-spin-button {\n            -webkit-appearance: none;\n            margin: 0;\n          }\n          .flarum-page-counter-input {\n            -moz-appearance: textfield;\n          }\n        ",document.head.appendChild(e)}const a=()=>{l.style.border="1px solid rgba(100, 150, 255, 0.8)",l.style.backgroundColor="rgba(60, 60, 60, 0.8)",l.style.boxShadow="0 0 0 2px rgba(30, 100, 200, 0.3)"},s=()=>{l.style.border="1px solid rgba(255, 255, 255, 0.2)",l.style.backgroundColor="rgba(50, 50, 50, 0.6)",l.style.boxShadow="none"};l.addEventListener("focus",a),l.addEventListener("blur",s),l._pageCounterFocusHandler=a,l._pageCounterBlurHandler=s,l.addEventListener("keydown",e),l.addEventListener("change",n),u=document.createElement("span"),u.className="flarum-page-counter-total",u.textContent=" / ...",Object.assign(u.style,{padding:"0 4px",userSelect:"none",pointerEvents:"none"}),i.appendChild(l),i.appendChild(u),document.body.appendChild(i),d=!0}function x(){d&&i&&i.remove(),i=document.createElement("div"),i.className="flarum-page-counter-container-placeholder",Object.assign(i.style,{position:"fixed",bottom:"20px",right:"20px",zIndex:"9999",backgroundColor:"rgba(40, 40, 40, 0.5)",border:"1px dashed rgba(100, 100, 100, 0.4)",borderRadius:"16px",padding:"6px 8px",display:"flex",alignItems:"center",gap:"6px",fontSize:"15px",fontWeight:"600",color:"rgba(200, 200, 200, 0.7)",boxShadow:"0 2px 10px rgba(0, 0, 0, 0.2)",transition:"opacity 0.2s ease",opacity:"0.7",pointerEvents:"none"});const e=document.createElement("span");e.className="page-counter-placeholder-part",e.textContent="...",Object.assign(e.style,{padding:"6px 8px",margin:"0",backgroundColor:"rgba(60, 60, 60, 0.4)",color:"rgba(200, 200, 200, 0.7)",borderRadius:"12px",fontSize:"15px",fontWeight:"600",userSelect:"none"});const n=document.createElement("span");n.className="page-counter-placeholder-part",n.textContent=" / ...",Object.assign(n.style,{padding:"0 4px",userSelect:"none",pointerEvents:"none"}),i.appendChild(e),i.appendChild(n),document.body.appendChild(i),d=!0,l=null,u=null}function b(){i&&(i._pageCounterMouseEnterHandler&&(i.removeEventListener("mouseenter",i._pageCounterMouseEnterHandler),delete i._pageCounterMouseEnterHandler),i._pageCounterMouseLeaveHandler&&(i.removeEventListener("mouseleave",i._pageCounterMouseLeaveHandler),delete i._pageCounterMouseLeaveHandler)),l&&(l._pageCounterFocusHandler&&(l.removeEventListener("focus",l._pageCounterFocusHandler),delete l._pageCounterFocusHandler),l._pageCounterBlurHandler&&(l.removeEventListener("blur",l._pageCounterBlurHandler),delete l._pageCounterBlurHandler))}function v(e,n,o){const r=parseInt(e,10);if(isNaN(r)||r<1||r>n)return void alert("Please enter a page number between 1 and ".concat(n,"."));const a=20*(r-1)+1;if(!o)return void console.error("Cannot navigate: Current discussion ID unknown.");const s=t().store.getById("discussions",o);if(!s)return void console.error("Cannot navigate: Discussion model not found in store.");const i=t().route.discussion(s,a);t().history&&"function"==typeof t().history.pushState?t().history.pushState(null,i):window.location.assign(i)}flarum.reg.add("laitouaigre-pages","forum/components/PageCounterDisplay",{getPageNumberInput:c,getTotalPagesSpan:function(){return u},isDisplayAdded:p,getContainer:function(){return i},updateDisplay:g,removeDisplay:m,removeInputListeners:function(e,n){l&&(l.removeEventListener("keydown",e),l.removeEventListener("change",n))},createInteractiveElement:f,createPlaceholderElement:x,removeAllListeners:b}),flarum.reg.add("laitouaigre-pages","forum/handlers/navigationHandler",{goToPage:v});let h=0,y=0,C=null;function E(){return h}function w(){return y}function L(){return C}function S(e){h=e,y=Math.ceil(h/20)}function H(e){C=e}function M(){h=0,y=0,C=null}flarum.reg.add("laitouaigre-pages","forum/state/pageCounterState",{getTotalPosts:E,getTotalPages:w,getCurrentDiscussionId:L,setTotalPosts:S,setCurrentDiscussionId:H,resetState:M});let _=!1;function k(e){return function(){_||(window.requestAnimationFrame(()=>{const n=e();if(n>0){const e=s();g(Math.max(1,Math.min(n,Math.ceil(e/20))),n)}_=!1}),_=!0)}}function I(e){const n=w(),t=L();n>0&&t&&v(e,n,t)}flarum.reg.add("laitouaigre-pages","forum/handlers/eventHandlers",{createOnScrollHandler:k,handleInputChange:function(){I(this.value)},handleInputSubmission:function(e){"Enter"===e.key&&(e.preventDefault(),I(e.target.value))}}),t().initializers.add("laitouaigre-pagesd-page-counter",()=>{let e=null;function n(n){const t=n.discussion;if(!t)return void(p()&&(b(),m(),e&&(window.removeEventListener("scroll",e),e=null),M()));const o=t.attribute("lastPostNumber");if("number"!=typeof o||o<=0)return p()||x(),M(),void(e&&(window.removeEventListener("scroll",e),e=null));const r=o!==E();if(r&&(S(o),H(t.id())),p()){if(r){const e=w(),n=s();g(Math.max(1,Math.min(e,Math.ceil(n/20))),e)}}else{const n=function(e){if("Enter"===e.key){e.preventDefault();const n=c().value,t=w(),o=L();t>0&&o&&v(n,t,o)}},t=function(){const e=this.value,n=w(),t=L();n>0&&t&&v(e,n,t)};f(n,t),e=k(()=>w()),window.addEventListener("scroll",e,{passive:!0}),setTimeout(()=>{const e=w();if(e>0){const n=s();g(Math.max(1,Math.min(e,Math.ceil(n/20))),e)}},100)}}(0,o.extend)(a().prototype,"oncreate",function(){n(this)}),(0,o.extend)(a().prototype,"onupdate",function(){n(this)}),(0,o.extend)(a().prototype,"onremove",function(){e&&(window.removeEventListener("scroll",e),e=null),b(),m(),M()})})})(),module.exports={}})();
//# sourceMappingURL=forum.js.map